server {
    listen 80;
    server_name localhost;

    # Set the root to the actual directory where the app files are.
    # This assumes the proxy (Konga) strips the /mes-app prefix.
    root /usr/share/nginx/html/mes-app;

    # Handle all requests. The proxy should have stripped the base path.
    location / {
        # Standard "try files" for a Single Page Application (SPA).
        # It tries the file, then the directory, then falls back to index.html
        # which allows client-side routing to take over.
        try_files $uri $uri/ /index.html;
    }

    # Configure the proxy for MQTT WebSocket connections.
    # This path is absolute and won't be affected by the root directive.
    location /mqtt {
        proxy_pass http://supos-dev.supos.app:8083;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_set_header Host $host;
        proxy_read_timeout 86400; # Set a long timeout for persistent connections.
    }
}
